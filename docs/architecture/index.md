# Fullstack Architecture Document -- ForecastingMRP

## Table of Contents

- [Fullstack Architecture Document -- ForecastingMRP](#table-of-contents)
  - [Metadata](./metadata.md)
  - [1. Architecture Overview](./1-architecture-overview.md)
    - [1.1 High-Level System Diagram](./1-architecture-overview.md#11-high-level-system-diagram)
    - [1.2 Service Communication Patterns](./1-architecture-overview.md#12-service-communication-patterns)
    - [1.3 Deployment Topology](./1-architecture-overview.md#13-deployment-topology)
  - [2. Monorepo Structure](./2-monorepo-structure.md)
    - [2.1 Turborepo Configuration Rationale](./2-monorepo-structure.md#21-turborepo-configuration-rationale)
    - [2.2 Directory Structure](./2-monorepo-structure.md#22-directory-structure)
    - [2.3 Package Dependency Graph](./2-monorepo-structure.md#23-package-dependency-graph)
    - [2.4 Build Pipeline (turbo.json)](./2-monorepo-structure.md#24-build-pipeline-turbojson)
    - [2.5 Shared Types Strategy (packages/shared)](./2-monorepo-structure.md#25-shared-types-strategy-packagesshared)
  - [3. Frontend Architecture (apps/web)](./3-frontend-architecture-appsweb.md)
    - [3.1 Next.js 14 App Router Structure](./3-frontend-architecture-appsweb.md#31-nextjs-14-app-router-structure)
    - [3.2 Server Components vs Client Components Strategy](./3-frontend-architecture-appsweb.md#32-server-components-vs-client-components-strategy)
    - [3.3 State Management Approach](./3-frontend-architecture-appsweb.md#33-state-management-approach)
    - [3.4 API Client Layer Design](./3-frontend-architecture-appsweb.md#34-api-client-layer-design)
    - [3.5 ECharts Integration Pattern (SSR-Safe)](./3-frontend-architecture-appsweb.md#35-echarts-integration-pattern-ssr-safe)
    - [3.6 WebSocket Integration for Real-Time Updates](./3-frontend-architecture-appsweb.md#36-websocket-integration-for-real-time-updates)
    - [3.7 Authentication Flow](./3-frontend-architecture-appsweb.md#37-authentication-flow)
    - [3.8 Route Structure Mapping to PRD Screens](./3-frontend-architecture-appsweb.md#38-route-structure-mapping-to-prd-screens)
  - [4. Backend Architecture (apps/api)](./4-backend-architecture-appsapi.md)
    - [4.1 NestJS Module Structure](./4-backend-architecture-appsapi.md#41-nestjs-module-structure)
    - [4.2 Module Responsibilities](./4-backend-architecture-appsapi.md#42-module-responsibilities)
    - [4.3 Database Access Strategy (Prisma ORM)](./4-backend-architecture-appsapi.md#43-database-access-strategy-prisma-orm)
    - [4.4 Error Handling Patterns](./4-backend-architecture-appsapi.md#44-error-handling-patterns)
    - [4.5 API Versioning Strategy](./4-backend-architecture-appsapi.md#45-api-versioning-strategy)
    - [4.6 Request Validation](./4-backend-architecture-appsapi.md#46-request-validation)
  - [5. ML/Forecasting Architecture (apps/forecast-engine)](./5-mlforecasting-architecture-appsforecast-engine.md)
    - [5.1 FastAPI Service Structure](./5-mlforecasting-architecture-appsforecast-engine.md#51-fastapi-service-structure)
    - [5.2 Model Architecture](./5-mlforecasting-architecture-appsforecast-engine.md#52-model-architecture)
      - [Model Selection Matrix (FR-022)](./5-mlforecasting-architecture-appsforecast-engine.md#model-selection-matrix-fr-022)
      - [Model Specifications](./5-mlforecasting-architecture-appsforecast-engine.md#model-specifications)
    - [5.3 Training Pipeline (BullMQ Workers)](./5-mlforecasting-architecture-appsforecast-engine.md#53-training-pipeline-bullmq-workers)
    - [5.4 Prediction Pipeline (REST Sync)](./5-mlforecasting-architecture-appsforecast-engine.md#54-prediction-pipeline-rest-sync)
    - [5.5 Model Versioning and Storage](./5-mlforecasting-architecture-appsforecast-engine.md#55-model-versioning-and-storage)
    - [5.6 Feature Engineering Pipeline](./5-mlforecasting-architecture-appsforecast-engine.md#56-feature-engineering-pipeline)
    - [5.7 NestJS <-> FastAPI Communication Summary](./5-mlforecasting-architecture-appsforecast-engine.md#57-nestjs-fastapi-communication-summary)
  - [6. Data Architecture](./6-data-architecture.md)
    - [6.1 PostgreSQL 16 Schema Overview](./6-data-architecture.md#61-postgresql-16-schema-overview)
    - [6.2 Table Groups](./6-data-architecture.md#62-table-groups)
    - [6.3 TimescaleDB Hypertable Strategy](./6-data-architecture.md#63-timescaledb-hypertable-strategy)
    - [6.4 Index Strategy](./6-data-architecture.md#64-index-strategy)
    - [6.5 Migration Strategy](./6-data-architecture.md#65-migration-strategy)
    - [6.6 Seed Data Approach (FR-005)](./6-data-architecture.md#66-seed-data-approach-fr-005)
    - [6.7 Connection Pooling](./6-data-architecture.md#67-connection-pooling)
  - [7. Infrastructure & DevOps](./7-infrastructure-devops.md)
    - [7.1 Docker Compose Services (Dev Environment)](./7-infrastructure-devops.md#71-docker-compose-services-dev-environment)
    - [7.2 CI/CD Pipeline (GitHub Actions)](./7-infrastructure-devops.md#72-cicd-pipeline-github-actions)
      - [PR Pipeline (ci.yml)](./7-infrastructure-devops.md#pr-pipeline-ciyml)
    - [7.3 Environment Management](./7-infrastructure-devops.md#73-environment-management)
    - [7.4 Logging Strategy](./7-infrastructure-devops.md#74-logging-strategy)
    - [7.5 Monitoring Approach](./7-infrastructure-devops.md#75-monitoring-approach)
    - [7.6 AWS EKS Production Architecture (Phase 5)](./7-infrastructure-devops.md#76-aws-eks-production-architecture-phase-5)
  - [8. Security Architecture](./8-security-architecture.md)
    - [8.1 Authentication: JWT with Refresh Tokens](./8-security-architecture.md#81-authentication-jwt-with-refresh-tokens)
    - [8.2 Authorization: RBAC](./8-security-architecture.md#82-authorization-rbac)
    - [8.3 API Security](./8-security-architecture.md#83-api-security)
    - [8.4 Data Protection](./8-security-architecture.md#84-data-protection)
  - [9. Integration Patterns](./9-integration-patterns.md)
    - [9.1 Email Integration (FR-050)](./9-integration-patterns.md#91-email-integration-fr-050)
    - [9.2 ERP Connector Pattern (FR-051)](./9-integration-patterns.md#92-erp-connector-pattern-fr-051)
    - [9.3 Export Patterns (FR-058)](./9-integration-patterns.md#93-export-patterns-fr-058)
    - [9.4 Webhook Patterns for Notifications (FR-062)](./9-integration-patterns.md#94-webhook-patterns-for-notifications-fr-062)
  - [10. Architecture Decision Records (ADRs)](./10-architecture-decision-records-adrs.md)
    - [ADR-001: Monorepo with Turborepo](./10-architecture-decision-records-adrs.md#adr-001-monorepo-with-turborepo)
    - [ADR-002: Separate FastAPI Service for ML (Not NestJS)](./10-architecture-decision-records-adrs.md#adr-002-separate-fastapi-service-for-ml-not-nestjs)
    - [ADR-003: BullMQ for Async Job Processing](./10-architecture-decision-records-adrs.md#adr-003-bullmq-for-async-job-processing)
    - [ADR-004: Prisma as ORM](./10-architecture-decision-records-adrs.md#adr-004-prisma-as-orm)
    - [ADR-005: Apache ECharts Over Other Chart Libraries](./10-architecture-decision-records-adrs.md#adr-005-apache-echarts-over-other-chart-libraries)
    - [ADR-006: TimescaleDB for Time Series Optimization](./10-architecture-decision-records-adrs.md#adr-006-timescaledb-for-time-series-optimization)
    - [ADR-007: Shadcn/UI as Component Foundation](./10-architecture-decision-records-adrs.md#adr-007-shadcnui-as-component-foundation)
    - [ADR-008: Server Components Strategy for Next.js 14](./10-architecture-decision-records-adrs.md#adr-008-server-components-strategy-for-nextjs-14)
  - [11. Cross-Cutting Concerns](./11-cross-cutting-concerns.md)
    - [11.1 Error Handling Strategy](./11-cross-cutting-concerns.md#111-error-handling-strategy)
    - [11.2 Pagination Pattern](./11-cross-cutting-concerns.md#112-pagination-pattern)
    - [11.3 Caching Strategy](./11-cross-cutting-concerns.md#113-caching-strategy)
    - [11.4 Internationalization Approach (CON-009)](./11-cross-cutting-concerns.md#114-internationalization-approach-con-009)
  - [12. Appendices](./12-appendices.md)
    - [12.1 Glossary](./12-appendices.md#121-glossary)
    - [12.2 Module-to-Requirement Traceability](./12-appendices.md#122-module-to-requirement-traceability)
    - [12.3 Constraint Impact Matrix](./12-appendices.md#123-constraint-impact-matrix)
  - [13. Suggested PRD Updates](./13-suggested-prd-updates.md)
