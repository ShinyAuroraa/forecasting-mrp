# 13. Suggested PRD Updates

Based on the architecture analysis, the following gaps and clarifications are recommended for `docs/prd.md`:

1. **Missing `usuario` table definition (Section 3):** The PRD references `usuario(id)` in foreign keys (e.g., `evento_capacidade.usuario_id`, `execucao_planejamento.created_by`) but does not include the table schema. Recommend adding a `usuario` table definition with fields: id (UUID), email, nome, senha_hash, role (enum: admin/manager/operator/viewer), ativo (boolean), created_at, updated_at.

2. **Missing `forecast_metrica` and `forecast_modelo` tables:** FR-032 (Forecast Metrics Storage) and FR-033 (Model Metadata Storage) reference storing metrics and model metadata, and the forecast execution pipeline step 9 references saving to `forecast_metrica` and `forecast_modelo`. These tables are not defined in Section 3. Recommend adding explicit schemas.

3. **Missing `sku_classification` table:** FR-020 (Automatic Classification) stores ABC/XYZ/demand pattern results per SKU. The pipeline step 2 references `sku_classification.modelo_forecast_sugerido`. This table is not defined in Section 3. Recommend adding a `sku_classification` table.

4. **WebSocket event schema not formalized:** The PRD describes WebSocket progress events (Section 2.2) but does not define the event payload schema. The frontend spec (Section 9.3) defines `job:progress`, `job:completed`, `job:failed` events. Recommend adding these to the PRD as a formal interface contract.

5. **API endpoint inventory not documented:** The PRD defines functional requirements but does not list specific REST endpoints. Recommend adding an API endpoint appendix for unambiguous implementation.

6. **MRP engine location ambiguity:** PRD Section 2.1 states "MRP/MRP II Engine (NestJS or Python)". Architecture decision: implemented in NestJS (TypeScript) since MRP is deterministic algorithmic computation, not ML. Recommend updating PRD to state "NestJS" definitively.

7. **Missing `movimentacao_estoque` table for time series:** The ingestion pipeline processes daily stock movements and billing data, but there is no explicit table for storing the cleaned time series data that feeds the forecasting models. The `forecast_resultado` stores outputs, but the raw input time series (weekly aggregated sales/volume per SKU) needs a table. Recommend adding a `serie_temporal` or `dados_limpos` table.

---

*This architecture document was generated by the Architect Agent (Aria) from PRD v2.0, Frontend Spec v1.0, and Project Brief v1.0. All architectural decisions trace to PRD requirements (Article IV compliance). No invented features.*
