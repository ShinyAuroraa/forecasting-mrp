# PRD -- ForecastingMRP (Formalized)

## Table of Contents

- [PRD -- ForecastingMRP (Formalized)](#table-of-contents)
  - [Metadata](./metadata.md)
  - [1. Vision & Problem Statement](./1-vision-problem-statement.md)
    - [1.1 Problem](./1-vision-problem-statement.md#11-problem)
    - [1.2 Solution](./1-vision-problem-statement.md#12-solution)
    - [1.3 Components and Justifications](./1-vision-problem-statement.md#13-components-and-justifications)
    - [1.4 Target Users](./1-vision-problem-statement.md#14-target-users)
    - [1.5 Goals & Success Metrics](./1-vision-problem-statement.md#15-goals-success-metrics)
  - [2. Architecture Overview](./2-architecture-overview.md)
    - [2.1 Layer Diagram](./2-architecture-overview.md#21-layer-diagram)
    - [2.2 Service Communication](./2-architecture-overview.md#22-service-communication)
      - [2.2.1 WebSocket Event Schemas](./2-architecture-overview.md#221-websocket-event-schemas)
    - [2.3 Tech Stack](./2-architecture-overview.md#23-tech-stack)
    - [2.4 Architecture Pattern](./2-architecture-overview.md#24-architecture-pattern)
  - [3. Data Model](./3-data-model.md)
    - [3.1 Registration Tables](./3-data-model.md#31-registration-tables)
      - [3.1.1 ](./3-data-model.md#311)
      - [3.1.2 ](./3-data-model.md#312)
      - [3.1.3 ](./3-data-model.md#313)
      - [3.1.4 ](./3-data-model.md#314)
      - [3.1.5  (N:N)](./3-data-model.md#315-nn)
      - [3.1.6  (Bill of Materials)](./3-data-model.md#316-bill-of-materials)
      - [3.1.7 ](./3-data-model.md#317)
      - [3.1.8 ](./3-data-model.md#318)
    - [3.2 Production Capacity Tables](./3-data-model.md#32-production-capacity-tables)
      - [3.2.1 ](./3-data-model.md#321)
      - [3.2.2 ](./3-data-model.md#322)
      - [3.2.3 ](./3-data-model.md#323)
      - [3.2.4 ](./3-data-model.md#324)
      - [3.2.5 ](./3-data-model.md#325)
      - [3.2.6 ](./3-data-model.md#326)
    - [3.3 Result Tables](./3-data-model.md#33-result-tables)
      - [3.3.1 ](./3-data-model.md#331)
      - [3.3.2 ](./3-data-model.md#332)
      - [3.3.3 ](./3-data-model.md#333)
      - [3.3.4 ](./3-data-model.md#334)
      - [3.3.5 ](./3-data-model.md#335)
      - [3.3.6 ](./3-data-model.md#336)
      - [3.3.7 ](./3-data-model.md#337)
      - [3.3.8 ](./3-data-model.md#338)
      - [3.3.9 ](./3-data-model.md#339)
      - [3.3.10 ](./3-data-model.md#3310)
    - [3.4 Configuration Tables](./3-data-model.md#34-configuration-tables)
    - [3.5 System Tables](./3-data-model.md#35-system-tables)
      - [3.5.1 ](./3-data-model.md#351)
  - [4. Functional Requirements](./4-functional-requirements.md)
    - [4.1 Epic 0 -- Infrastructure Setup (FR-001 to FR-005)](./4-functional-requirements.md#41-epic-0-infrastructure-setup-fr-001-to-fr-005)
      - [FR-001: Monorepo Scaffold](./4-functional-requirements.md#fr-001-monorepo-scaffold)
      - [FR-002: Docker Compose Environment](./4-functional-requirements.md#fr-002-docker-compose-environment)
      - [FR-003: Database Schema (Registration Tables)](./4-functional-requirements.md#fr-003-database-schema-registration-tables)
      - [FR-004: CI/CD Pipeline](./4-functional-requirements.md#fr-004-cicd-pipeline)
      - [FR-005: Synthetic Seed Data](./4-functional-requirements.md#fr-005-synthetic-seed-data)
    - [4.2 Epic 1 -- Foundation: Data Layer & CRUDs (FR-006 to FR-020)](./4-functional-requirements.md#42-epic-1-foundation-data-layer-cruds-fr-006-to-fr-020)
      - [FR-006: Authentication Module](./4-functional-requirements.md#fr-006-authentication-module)
      - [FR-007: Product CRUD](./4-functional-requirements.md#fr-007-product-crud)
      - [FR-008: Product Mass Import](./4-functional-requirements.md#fr-008-product-mass-import)
      - [FR-009: BOM CRUD (Bill of Materials)](./4-functional-requirements.md#fr-009-bom-crud-bill-of-materials)
      - [FR-010: BOM Exploded Cost Display](./4-functional-requirements.md#fr-010-bom-exploded-cost-display)
      - [FR-011: Supplier CRUD](./4-functional-requirements.md#fr-011-supplier-crud)
      - [FR-012: SKU-Supplier Linkage](./4-functional-requirements.md#fr-012-sku-supplier-linkage)
      - [FR-013: Work Center CRUD](./4-functional-requirements.md#fr-013-work-center-crud)
      - [FR-014: Shift Management](./4-functional-requirements.md#fr-014-shift-management)
      - [FR-015: Scheduled Stops Management](./4-functional-requirements.md#fr-015-scheduled-stops-management)
      - [FR-016: Capacity Events Management](./4-functional-requirements.md#fr-016-capacity-events-management)
      - [FR-017: Storage Capacity (Warehouse) Management](./4-functional-requirements.md#fr-017-storage-capacity-warehouse-management)
      - [FR-018: Inventory Management](./4-functional-requirements.md#fr-018-inventory-management)
      - [FR-019: Data Ingestion Pipeline (Basic)](./4-functional-requirements.md#fr-019-data-ingestion-pipeline-basic)
      - [FR-020: Automatic Classification (ABC, XYZ, Demand Pattern)](./4-functional-requirements.md#fr-020-automatic-classification-abc-xyz-demand-pattern)
    - [4.3 Epic 2 -- Intelligence: Forecasting Engine (FR-021 to FR-033)](./4-functional-requirements.md#43-epic-2-intelligence-forecasting-engine-fr-021-to-fr-033)
      - [FR-021: FastAPI Microservice Setup](./4-functional-requirements.md#fr-021-fastapi-microservice-setup)
      - [FR-022: Multi-Model Strategy Engine](./4-functional-requirements.md#fr-022-multi-model-strategy-engine)
      - [FR-023: TFT Model (Volume)](./4-functional-requirements.md#fr-023-tft-model-volume)
      - [FR-024: TFT Model (Revenue)](./4-functional-requirements.md#fr-024-tft-model-revenue)
      - [FR-025: ETS Model (Holt-Winters)](./4-functional-requirements.md#fr-025-ets-model-holt-winters)
      - [FR-026: Croston/TSB Model](./4-functional-requirements.md#fr-026-crostontsb-model)
      - [FR-027: Forecast Execution Pipeline](./4-functional-requirements.md#fr-027-forecast-execution-pipeline)
      - [FR-028: Revenue Forecasting -- Dual Approach](./4-functional-requirements.md#fr-028-revenue-forecasting-dual-approach)
      - [FR-029: Backtesting Pipeline](./4-functional-requirements.md#fr-029-backtesting-pipeline)
      - [FR-030: NestJS-FastAPI Integration via BullMQ](./4-functional-requirements.md#fr-030-nestjs-fastapi-integration-via-bullmq)
      - [FR-031: Forecast Dashboard](./4-functional-requirements.md#fr-031-forecast-dashboard)
      - [FR-032: Forecast Metrics Storage](./4-functional-requirements.md#fr-032-forecast-metrics-storage)
      - [FR-033: Model Metadata Storage](./4-functional-requirements.md#fr-033-model-metadata-storage)
    - [4.4 Epic 3 -- MRP: Planning Engine (FR-034 to FR-049)](./4-functional-requirements.md#44-epic-3-mrp-planning-engine-fr-034-to-fr-049)
      - [FR-034: Master Production Schedule (MPS)](./4-functional-requirements.md#fr-034-master-production-schedule-mps)
      - [FR-035: Stock Parameter Calculation](./4-functional-requirements.md#fr-035-stock-parameter-calculation)
      - [FR-036: Multi-Level BOM Explosion (Low-Level Coding)](./4-functional-requirements.md#fr-036-multi-level-bom-explosion-low-level-coding)
      - [FR-037: Lot Sizing](./4-functional-requirements.md#fr-037-lot-sizing)
      - [FR-038: Planned Order Generation](./4-functional-requirements.md#fr-038-planned-order-generation)
      - [FR-039: Action Messages](./4-functional-requirements.md#fr-039-action-messages)
      - [FR-040: Capacity Requirements Planning (CRP)](./4-functional-requirements.md#fr-040-capacity-requirements-planning-crp)
      - [FR-041: Storage Capacity Validation](./4-functional-requirements.md#fr-041-storage-capacity-validation)
      - [FR-042: Purchasing Panel](./4-functional-requirements.md#fr-042-purchasing-panel)
      - [FR-043: MRP Dashboard (Gantt)](./4-functional-requirements.md#fr-043-mrp-dashboard-gantt)
      - [FR-044: MRP Detail Table](./4-functional-requirements.md#fr-044-mrp-detail-table)
      - [FR-045: Stock Projection Chart](./4-functional-requirements.md#fr-045-stock-projection-chart)
      - [FR-046: Capacity Dashboard](./4-functional-requirements.md#fr-046-capacity-dashboard)
      - [FR-047: Production Routing CRUD](./4-functional-requirements.md#fr-047-production-routing-crud)
      - [FR-048: Factory Calendar Management](./4-functional-requirements.md#fr-048-factory-calendar-management)
      - [FR-049: Net Requirement Calculation Engine](./4-functional-requirements.md#fr-049-net-requirement-calculation-engine)
    - [4.5 Epic 4 -- Automation & BI (FR-050 to FR-063)](./4-functional-requirements.md#45-epic-4-automation-bi-fr-050-to-fr-063)
      - [FR-050: Email Listener](./4-functional-requirements.md#fr-050-email-listener)
      - [FR-051: ERP Connector](./4-functional-requirements.md#fr-051-erp-connector)
      - [FR-052: Daily Automated Pipeline](./4-functional-requirements.md#fr-052-daily-automated-pipeline)
      - [FR-053: Daily Summary Email](./4-functional-requirements.md#fr-053-daily-summary-email)
      - [FR-054: Executive Dashboard](./4-functional-requirements.md#fr-054-executive-dashboard)
      - [FR-055: LightGBM Model](./4-functional-requirements.md#fr-055-lightgbm-model)
      - [FR-056: Ensemble Model (Class A SKUs)](./4-functional-requirements.md#fr-056-ensemble-model-class-a-skus)
      - [FR-057: What-If Scenario Analysis](./4-functional-requirements.md#fr-057-what-if-scenario-analysis)
      - [FR-058: Excel/PDF Export](./4-functional-requirements.md#fr-058-excelpdf-export)
      - [FR-059: Re-training Cycles](./4-functional-requirements.md#fr-059-re-training-cycles)
      - [FR-060: OCR for PDF Attachments](./4-functional-requirements.md#fr-060-ocr-for-pdf-attachments)
      - [FR-061: Ingestion Mapping Template](./4-functional-requirements.md#fr-061-ingestion-mapping-template)
      - [FR-062: Alert System](./4-functional-requirements.md#fr-062-alert-system)
      - [FR-063: Morning Briefing Email](./4-functional-requirements.md#fr-063-morning-briefing-email)
    - [4.6 Epic 5 -- Refinement & Production (FR-064 to FR-076)](./4-functional-requirements.md#46-epic-5-refinement-production-fr-064-to-fr-076)
      - [FR-064: Wagner-Whitin Lot Sizing](./4-functional-requirements.md#fr-064-wagner-whitin-lot-sizing)
      - [FR-065: Monte Carlo Safety Stock (Class A)](./4-functional-requirements.md#fr-065-monte-carlo-safety-stock-class-a)
      - [FR-066: Champion-Challenger Model Selection](./4-functional-requirements.md#fr-066-champion-challenger-model-selection)
      - [FR-067: Drift Detection and Auto-Retraining](./4-functional-requirements.md#fr-067-drift-detection-and-auto-retraining)
      - [FR-068: Manual Forecast Override](./4-functional-requirements.md#fr-068-manual-forecast-override)
      - [FR-069: BOM Versioning](./4-functional-requirements.md#fr-069-bom-versioning)
      - [FR-070: Historical Lead Time Tracking](./4-functional-requirements.md#fr-070-historical-lead-time-tracking)
      - [FR-071: PDF Management Reports](./4-functional-requirements.md#fr-071-pdf-management-reports)
      - [FR-072: Integration Testing](./4-functional-requirements.md#fr-072-integration-testing)
      - [FR-073: Load Testing](./4-functional-requirements.md#fr-073-load-testing)
      - [FR-074: Production Deployment (AWS EKS)](./4-functional-requirements.md#fr-074-production-deployment-aws-eks)
      - [FR-075: User Activity Logging](./4-functional-requirements.md#fr-075-user-activity-logging)
      - [FR-076: System Configuration UI](./4-functional-requirements.md#fr-076-system-configuration-ui)
  - [5. Non-Functional Requirements](./5-non-functional-requirements.md)
    - [5.1 Performance](./5-non-functional-requirements.md#51-performance)
      - [NFR-001: Daily Pipeline Processing Time](./5-non-functional-requirements.md#nfr-001-daily-pipeline-processing-time)
      - [NFR-002: Forecast Accuracy -- Volume (Class A)](./5-non-functional-requirements.md#nfr-002-forecast-accuracy-volume-class-a)
      - [NFR-003: Forecast Accuracy -- Volume (Class B)](./5-non-functional-requirements.md#nfr-003-forecast-accuracy-volume-class-b)
      - [NFR-004: Forecast Accuracy -- Volume (Class C)](./5-non-functional-requirements.md#nfr-004-forecast-accuracy-volume-class-c)
      - [NFR-005: Forecast Accuracy -- Revenue (Class A)](./5-non-functional-requirements.md#nfr-005-forecast-accuracy-revenue-class-a)
      - [NFR-006: Forecast Accuracy -- Revenue (Class B)](./5-non-functional-requirements.md#nfr-006-forecast-accuracy-revenue-class-b)
      - [NFR-007: Fill Rate (OTIF) -- Class A](./5-non-functional-requirements.md#nfr-007-fill-rate-otif-class-a)
      - [NFR-008: Fill Rate (OTIF) -- Class B](./5-non-functional-requirements.md#nfr-008-fill-rate-otif-class-b)
      - [NFR-009: Fill Rate (OTIF) -- Class C](./5-non-functional-requirements.md#nfr-009-fill-rate-otif-class-c)
      - [NFR-010: Inventory Turnover](./5-non-functional-requirements.md#nfr-010-inventory-turnover)
      - [NFR-011: Stockout Rate](./5-non-functional-requirements.md#nfr-011-stockout-rate)
      - [NFR-012: Safety Stock Accuracy](./5-non-functional-requirements.md#nfr-012-safety-stock-accuracy)
    - [5.2 Availability & Reliability](./5-non-functional-requirements.md#52-availability-reliability)
      - [NFR-013: System Availability](./5-non-functional-requirements.md#nfr-013-system-availability)
      - [NFR-014: Dead Letter Queue Handling](./5-non-functional-requirements.md#nfr-014-dead-letter-queue-handling)
      - [NFR-015: Retry Strategy](./5-non-functional-requirements.md#nfr-015-retry-strategy)
    - [5.3 Security](./5-non-functional-requirements.md#53-security)
      - [NFR-016: JWT Authentication](./5-non-functional-requirements.md#nfr-016-jwt-authentication)
      - [NFR-017: Role-Based Access Control (RBAC)](./5-non-functional-requirements.md#nfr-017-role-based-access-control-rbac)
      - [NFR-018: Input Validation](./5-non-functional-requirements.md#nfr-018-input-validation)
      - [NFR-019: CNPJ Validation](./5-non-functional-requirements.md#nfr-019-cnpj-validation)
      - [NFR-020: Read-Only ERP Connector](./5-non-functional-requirements.md#nfr-020-read-only-erp-connector)
      - [NFR-021: Environment-Based Secrets](./5-non-functional-requirements.md#nfr-021-environment-based-secrets)
    - [5.4 Scalability & Data](./5-non-functional-requirements.md#54-scalability-data)
      - [NFR-022: SKU Volume Support](./5-non-functional-requirements.md#nfr-022-sku-volume-support)
      - [NFR-023: Supplier Volume Support](./5-non-functional-requirements.md#nfr-023-supplier-volume-support)
      - [NFR-024: Historical Data Depth](./5-non-functional-requirements.md#nfr-024-historical-data-depth)
      - [NFR-025: Time Series Granularity](./5-non-functional-requirements.md#nfr-025-time-series-granularity)
      - [NFR-026: UUID Primary Keys](./5-non-functional-requirements.md#nfr-026-uuid-primary-keys)
      - [NFR-027: TimescaleDB Readiness](./5-non-functional-requirements.md#nfr-027-timescaledb-readiness)
    - [5.5 Code Quality](./5-non-functional-requirements.md#55-code-quality)
      - [NFR-028: Test Coverage](./5-non-functional-requirements.md#nfr-028-test-coverage)
      - [NFR-029: TypeScript Strict Mode](./5-non-functional-requirements.md#nfr-029-typescript-strict-mode)
  - [6. Constraints](./6-constraints.md)
      - [CON-001: GPU for TFT Training](./6-constraints.md#con-001-gpu-for-tft-training)
      - [CON-002: Minimum Historical Data for TFT](./6-constraints.md#con-002-minimum-historical-data-for-tft)
      - [CON-003: Daily Pipeline Time Limit](./6-constraints.md#con-003-daily-pipeline-time-limit)
      - [CON-004: BOM Data Quality Dependency](./6-constraints.md#con-004-bom-data-quality-dependency)
      - [CON-005: Intermittent Demand TFT Exclusion](./6-constraints.md#con-005-intermittent-demand-tft-exclusion)
      - [CON-006: Docker Compose / AWS EKS Parity](./6-constraints.md#con-006-docker-compose-aws-eks-parity)
      - [CON-007: 22-Week Development Timeline](./6-constraints.md#con-007-22-week-development-timeline)
      - [CON-008: Single-Plant Operation](./6-constraints.md#con-008-single-plant-operation)
      - [CON-009: Portuguese-Language UI](./6-constraints.md#con-009-portuguese-language-ui)
      - [CON-010: Single-Currency (BRL)](./6-constraints.md#con-010-single-currency-brl)
      - [CON-011: Tech Stack](./6-constraints.md#con-011-tech-stack)
      - [CON-012: Client Data Availability](./6-constraints.md#con-012-client-data-availability)
      - [CON-013: Client ERP Export Capability](./6-constraints.md#con-013-client-erp-export-capability)
  - [7. Epic Breakdown](./7-epic-breakdown.md)
    - [Epic 0: Infrastructure Setup](./7-epic-breakdown.md#epic-0-infrastructure-setup)
    - [Epic 1: Foundation -- Data Layer & CRUDs](./7-epic-breakdown.md#epic-1-foundation-data-layer-cruds)
    - [Epic 2: Intelligence -- Forecasting Engine](./7-epic-breakdown.md#epic-2-intelligence-forecasting-engine)
    - [Epic 3: MRP -- Planning Engine](./7-epic-breakdown.md#epic-3-mrp-planning-engine)
    - [Epic 4: Automation & BI](./7-epic-breakdown.md#epic-4-automation-bi)
    - [Epic 5: Refinement & Production](./7-epic-breakdown.md#epic-5-refinement-production)
  - [8. Business Rules Reference](./8-business-rules-reference.md)
    - [Forecasting Rules](./8-business-rules-reference.md#forecasting-rules)
    - [MRP Rules](./8-business-rules-reference.md#mrp-rules)
    - [Inventory Rules](./8-business-rules-reference.md#inventory-rules)
    - [Capacity Rules](./8-business-rules-reference.md#capacity-rules)
    - [Automation Rules](./8-business-rules-reference.md#automation-rules)
  - [9. Requirement Traceability Matrix](./9-requirement-traceability-matrix.md)
  - [10. Appendices](./10-appendices.md)
    - [Appendix A: Project Folder Structure](./10-appendices.md#appendix-a-project-folder-structure)
    - [Appendix B: Forecasting Algorithm Details](./10-appendices.md#appendix-b-forecasting-algorithm-details)
      - [B.1 Multi-Model Selection Matrix](./10-appendices.md#b1-multi-model-selection-matrix)
      - [B.2 Safety Stock Formulas](./10-appendices.md#b2-safety-stock-formulas)
      - [B.3 MRP Explosion Pseudocode](./10-appendices.md#b3-mrp-explosion-pseudocode)
      - [B.4 Lot Sizing Algorithms](./10-appendices.md#b4-lot-sizing-algorithms)
      - [B.5 CRP Algorithm](./10-appendices.md#b5-crp-algorithm)
      - [B.6 Available Capacity Calculation](./10-appendices.md#b6-available-capacity-calculation)
      - [B.7 Revenue Forecasting Dual Approach](./10-appendices.md#b7-revenue-forecasting-dual-approach)
    - [Appendix C: Risks & Open Questions](./10-appendices.md#appendix-c-risks-open-questions)
      - [Key Risks](./10-appendices.md#key-risks)
      - [Open Questions](./10-appendices.md#open-questions)
    - [Appendix D: Long-Term Vision (Post-Phase 5)](./10-appendices.md#appendix-d-long-term-vision-post-phase-5)
    - [Appendix E: API Endpoint Inventory](./10-appendices.md#appendix-e-api-endpoint-inventory)
